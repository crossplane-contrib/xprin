tests:
- name: "Base layer final loop"
  id: base_final
  patches:
    xrd: ../../base/xrd.yaml
  inputs:
    xr: ../../base/xr.yaml
    composition: ../../base/composition.yaml
    functions: ../../base/functions.yaml
    crds:
    - ../../base/xrd.yaml
    - ../../base/crossplane.yaml
    - ../../aws/xrd.yaml
    - ../../gcp/xrd.yaml

- name: "GCP layer first loop"
  id: gcp_first
  patches:
    xrd: ../../gcp/xrd.yaml
  inputs:
    xr: {{ index .Tests.base_final.Outputs.Rendered "XGCPInfrastructure/platform-base-gcp" }}
    composition: ../../gcp/composition.yaml
    functions: ../../gcp/functions.yaml
    crds:
    - ../../gcp/xrd.yaml
    - ../../gcp/crossplane.yaml

- name: "AWS layer first loop"
  id: aws_first
  patches:
    xrd: ../../aws/xrd.yaml
  inputs:
    xr: {{ index .Tests.base_final.Outputs.Rendered "XAWSInfrastructure/platform-base-aws" }}
    composition: ../../aws/composition.yaml
    functions: ../../aws/functions.yaml
    crds:
    - ../../aws/xrd.yaml
    - ../../aws/crossplane.yaml
